<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Crypto Water-Jug Race</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root{
      --bg:#111;
      --glass:#ffffff22;
      --water1:#9c27b0; /* purple */
      --water2:#ffeb3b; /* yellow */
    }
    body{background:var(--bg);color:#fff;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;margin:0;}
    h1{font-size:1.6rem;margin-bottom:1rem;font-weight:600;letter-spacing:-.5px;}
    .inputs{display:flex;gap:1rem;margin-bottom:2rem;flex-wrap:wrap;justify-content:center;}
    input{background:#222;border:1px solid #444;color:#fff;padding:.6rem 1rem;border-radius:8px;width:340px;max-width:90vw;}
    button{background:#0071e3;color:#fff;border:none;padding:.6rem 1.2rem;border-radius:8px;font-weight:600;cursor:pointer;}
    .jugs{display:flex;gap:3rem;flex-wrap:wrap;justify-content:center;}
    .jug{text-align:center;}
    .jug svg{width:140px;height:320px;}
    .label{margin-top:.6rem;font-size:1rem;font-weight:500;}
    .value{margin-top:.2rem;font-size:.9rem;color:#aaa;}
    .water{transition:height .8s cubic-bezier(.22,1,.36,1);}
  </style>
</head>
<body>
  <h1>Live Water-Jug Race</h1>
  <div class="inputs">
    <input id="addr1" placeholder="BTC / ETH address #1" value="3J98t1WpEZ73CNmQviecrnyiWrnqRhWNLy">
    <input id="addr2" placeholder="BTC / ETH address #2" value="0x742d35Cc6634C0532925a3b844Bc9e7595f525CE">
  </div>
  <button onclick="startRace()">Start / Reload</button>

  <div class="jugs">
    <div class="jug">
      <svg viewBox="0 0 140 320">
        <defs><clipPath id="clip1"><rect x="10" y="60" width="120" height="240" rx="8"/></clipPath></defs>
        <path d="M20 60h100c5 0 10 5 10 10v230c0 5-5 10-10 10H20c-5 0-10-5-10-10V70c0-5 5-10 10-10z" fill="none" stroke="var(--glass)" stroke-width="3"/>
        <rect id="water1" x="10" y="300" width="120" height="0" fill="var(--water1)" clip-path="url(#clip1)" class="water"/>
        <path d="M30 80a6 6 0 0112 0v180a6 6 0 01-12 0z" fill="#ffffff33"/>
      </svg>
      <div class="label">Jug 1</div>
      <div class="value" id="val1">$0</div>
    </div>

    <div class="jug">
      <svg viewBox="0 0 140 320">
        <defs><clipPath id="clip2"><rect x="10" y="60" width="120" height="240" rx="8"/></clipPath></defs>
        <path d="M20 60h100c5 0 10 5 10 10v230c0 5-5 10-10 10H20c-5 0-10-5-10-10V70c0-5 5-10 10-10z" fill="none" stroke="var(--glass)" stroke-width="3"/>
        <rect id="water2" x="10" y="300" width="120" height="0" fill="var(--water2)" clip-path="url(#clip2)" class="water"/>
        <path d="M30 80a6 6 0 0112 0v180a6 6 0 01-12 0z" fill="#ffffff33"/>
      </svg>
      <div class="label">Jug 2</div>
      <div class="value" id="val2">$0</div>
    </div>
  </div>

<script>
  const API = "https://api.covalenthq.com/v1";
  const KEY = "cqt_rQfq4g4k4k4g4k4g4k4g4k4g4k4g4k4g"; // 100 calls/min free
  let t1, t2;

  async function fetchBalance(chain, addr) {
    const url = `${API}/${chain}/address/${addr}/balances_usd/?key=${KEY}`;
    const r = await fetch(url);
    const j = await r.json();
    if (!j.data || !j.data.items) return 0;
    return j.data.items.reduce((s, t) => s + (t.quote || 0), 0);
  }

  async function updateJugs() {
    const a1 = document.getElementById('addr1').value.trim();
    const a2 = document.getElementById('addr2').value.trim();
    if (!a1 || !a2) return;
    const chain1 = a1.startsWith('0x') ? 'eth-mainnet' : 'btc-mainnet';
    const chain2 = a2.startsWith('0x') ? 'eth-mainnet' : 'btc-mainnet';
    const usd1 = await fetchBalance(chain1, a1);
    const usd2 = await fetchBalance(chain2, a2);
    const max = Math.max(usd1, usd2, 1);
    const h1 = Math.round((usd1 / max) * 240);
    const h2 = Math.round((usd2 / max) * 240);
    document.getElementById('water1').setAttribute('y', 300 - h1);
    document.getElementById('water1').setAttribute('height', h1);
    document.getElementById('water2').setAttribute('y', 300 - h2);
    document.getElementById('water2').setAttribute('height', h2);
    document.getElementById('val1').textContent = `$${usd1.toLocaleString(undefined, { maximumFractionDigits: 0 })}`;
    document.getElementById('val2').textContent = `$${usd2.toLocaleString(undefined, { maximumFractionDigits: 0 })}`;
  }

  function startRace() {
    if (t1) { clearInterval(t1); clearInterval(t2); }
    updateJugs();
    t1 = setInterval(updateJugs, 20000); // 20 s
    t2 = setInterval(() => document.querySelector('button').click(), 300000); // 5 min safety
  }

  startRace();
</script>
</body>
</html>